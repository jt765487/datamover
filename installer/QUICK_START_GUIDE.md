## Quick Start Guide: Basic `exportcliv2` and `bitmover` Setup ##

This guide walks you through the minimal steps to get a basic `exportcliv2` environment (with default instances) and the `bitmover` service up and running using the provided deployment scripts.

**Goal:** Install the application suite, configure one `exportcliv2` instance ("AAA"), and verify all relevant services are operational.

**Prerequisites:**

*   `sudo` (root) access on an Oracle Linux 9 (or compatible) system.
*   You have the `exportcliv2-suite-vX.Y.Z.tar.gz` distribution package.
*   Required system utilities (like `python3-venv`, `flock`) are installed.

**Steps:**

**Step 1: Extract the Package and Navigate into it**

1.  Copy the `exportcliv2-suite-vX.Y.Z.tar.gz` package to your server.
2.  Extract the archive:
    ```bash
    tar -xzvf exportcliv2-suite-vX.Y.Z.tar.gz
    ```
3.  Change into the created directory:
    ```bash
    cd exportcliv2-suite-vX.Y.Z/
    ```
    *All subsequent commands in this guide are run from within this directory.*

**Step 2: Configure `install-app.conf`**

The `install-app.conf` file, located in the `exportcliv2-deploy/` subdirectory, contains crucial settings. The filenames for the application binary and the datamover wheel are typically pre-filled by the bundling process.

1.  Open `exportcliv2-deploy/install-app.conf` with a text editor:
    ```bash
    nano exportcliv2-deploy/install-app.conf
    ```
2.  **Verify and/or Set the following MANDATORY variables:**
    *   `VERSIONED_APP_BINARY_FILENAME`: Ensure this matches the `exportcliv2` binary filename present in the `exportcliv2-deploy/` directory (e.g., `"exportcliv2-v0.4.0-B1771-24.11.15"`).
    *   `VERSIONED_DATAMOVER_WHEEL_FILENAME`: Ensure this matches the `datamover` Python wheel filename present in the `exportcliv2-deploy/` directory (e.g., `"datamover-0.1.0-py3-none-any.whl"`).
    *   `REMOTE_HOST_URL_CONFIG`: **You must set this** to the URL where `bitmover` should send data (e.g., `"http://your-ingest-server:8989/pcap"`).
    *   `EXPORT_TIMEOUT_CONFIG`: This sets a default timeout (in seconds) for `exportcliv2` instances (e.g., `"15"`).
3.  *(Optional)* Review other settings like `USER_CONFIG`, `GROUP_CONFIG`, or `BASE_DIR_CONFIG` if you need to customize them.
4.  Save the `install-app.conf` file.

**Step 3: Run the Orchestrator for Installation**

From the `exportcliv2-suite-vX.Y.Z/` directory, execute the main deployment script with the `--install` flag. This will use the default instances (e.g., "AAA", "BBB", "CCC") defined in the Orchestrator script.
```bash
sudo ./deploy_orchestrator.sh --install
```
*(If re-running on an already installed system, you might need `sudo ./deploy_orchestrator.sh --install --force` to overwrite existing instance configurations.)*

The script will:
1.  Check dependencies and acquire a lock.
2.  Ask for confirmation (if in an interactive terminal):
    ```
    Proceed with install for instances: (AAA,BBB,CCC) using source '/path/to/exportcliv2-suite-vX.Y.Z'? [y/N]
    ```
    Type `y` and press Enter.
3.  Run the base installer (`./exportcliv2-deploy/install_base_exportcliv2.sh`), which sets up users, directories, binaries, the `bitmover` wheel, systemd units, and the `exportcli-manage` symlink.
4.  Run the instance configurator (`./exportcliv2-deploy/configure_instance.sh`) for each default instance ("AAA", "BBB", "CCC").
5.  Run the service manager (`./exportcliv2-deploy/manage_services.sh`) to **enable and then start the main `bitmover.service` AND the services for each default `exportcliv2` instance**.

**Step 4: Post-Installation: Configure `exportcliv2` Instance "AAA"**

Each `exportcliv2` instance requires specific settings for your environment. Let's configure instance "AAA" as an example.

1.  Edit the instance configuration file for "AAA":
    ```bash
    sudo nano /etc/exportcliv2/AAA.conf
    ```
2.  Update these lines (the script generates this file with defaults based on `install-app.conf` and internal settings):
    ```ini
    # Generated by configure_instance.sh ...
    EXPORT_TIMEOUT="15" # From EXPORT_TIMEOUT_CONFIG in install-app.conf
    EXPORT_SOURCE="AAA" # Default, a unique tag for this instance's data
    EXPORT_STARTTIME_OFFSET_SPEC="3 minutes ago" # Default
    EXPORT_ENDTIME="-1" # Default
    EXPORT_IP="10.0.0.1" # Default, **MUST EDIT for your target IP**
    EXPORT_PORTID="1"    # Default, **MUST EDIT for your target port/interface**
    EXPORT_APP_CONFIG_FILE_PATH="/etc/exportcliv2/AAA_app.conf" # Default
    ```
    **Crucially, update `EXPORT_IP` and `EXPORT_PORTID`** to match your data source. You might also want to adjust `EXPORT_SOURCE` if needed.
3.  Save the file.
4.  *(You would repeat similar edits for `/etc/exportcliv2/BBB.conf` and `/etc/exportcliv2/CCC.conf` if you intend to use them).*

**Step 5: Restart the Configured `exportcliv2` Instance ("AAA")**

For the changes in `AAA.conf` to take effect, restart the "AAA" instance.
Use the `exportcli-manage` symlink (created in `/usr/local/bin` during installation):
```bash
sudo exportcli-manage -i AAA --restart
```
*(Or, from the `exportcliv2-suite-vX.Y.Z/` directory: `sudo ./exportcliv2-deploy/manage_services.sh -i AAA --restart`)*

**Step 6: Verify Services are Running**

All necessary services should have been started automatically by the orchestrator in Step 3.

*   **`exportcliv2` Instance "AAA":**
    ```bash
    sudo exportcli-manage -i AAA --status
    ```
    Look for `Active: active (running)` for `exportcliv2@AAA.service`. You'll also see status for its related `.path` unit (e.g., `exportcliv2-restart@AAA.path`).
*   **Bitmover Service:**
    ```bash
    sudo exportcli-manage --status
    ```
    Look for `Active: active (running)` for `bitmover.service`.

**Congratulations!** You should now have `exportcliv2` instance "AAA" and the `bitmover` service running.

**Next Steps:**

*   **View Logs:**
    ```bash
    sudo exportcli-manage -i AAA --logs-follow
    sudo exportcli-manage --logs-follow  # For bitmover logs
    ```
*   **Further Configuration & Updates:** Refer to the full "Application Suite Deployment and Management Guide" (the `USER_GUIDE.md` file in your `exportcliv2-suite-vX.Y.Z/` directory) for details on:
    *   Customizing installation paths (e.g., `BASE_DIR_CONFIG` in `install-app.conf`).
    *   Managing all default instances ("AAA", "BBB", "CCC") or installing specific instances using the `-i` flag with `deploy_orchestrator.sh`.
    *   Advanced `bitmover` settings (in `/etc/exportcliv2/config.ini`).
    *   Updating application components, including surgical updates.
    *   Detailed troubleshooting.
